<!DOCTYPE html>
<html>
  <head>
  
  	<meta charset="utf-8"/>
		<link rel="stylesheet" href="./design/pc/disposition.css" />
		<link rel="shortcut icon" href="./design/logo_gala.ico" />
		
    <title>MineNight in Paris - Le Gala des Mines de Paris</title>
    
    
  </head>
 
  <body>
		
		<!-- Google Analytics -->
		  <script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-37635054-2']);
		  _gaq.push(['_trackPageview']);

		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		</script>
 	
 		<!-- Mettre les liens ici aussi pour pouvoir faire une interface classique pour mobile -->
 		
 		<header>
 			<!--<h1>MineNight in Paris</h1>-->
			<img src = "./design/pc/images/titre.png" alt="MineNight in Paris - Le Gala des Mines de Paris" id="the_header">
 			<!--<h2>Le gala des Mines de Paris</h2>-->

 		</header>
		<!-- Les spots lumineux -->
		<img src="./design/pc/images/light-left.png" style="position:fixed;top:0;left:0">
		<img src="./design/pc/images/light-right.png" style="position:fixed;top:0;right:0">

 		
 		<nav id="meuf">
 			<!-- L'image du mec dont la source va changer lors des animations -->
    	<img id="imeuf0" alt="Meuf" src="./animations/meuf/1.png"/>
    	
    	<!-- La "devanture" du sac" -->
    	<img class="js_controlled" id="devant_sac" alt="devant_sac" src="./animations/meuf/devant_sac.png" />
    	<!-- La caméra -->
    	<img class="js_controlled" id="camera_meuf" alt="camera_meuf" src="./animations/meuf/camera.png" />
    	    	
    	<!-- Le portefeuille -->
    	<img class="js_controlled" id="portefeuille_meuf" alt="portefeuille_meuf" src="./animations/meuf/portefeuille.png" />
    	    	
    	<!-- Le lien de la cocotte lorsque le sac est devant/ouvert -->
    	<div  id="lien_preventes_sac_devant"></div>
    	
 		</nav>
    
 		
    <nav id="mec">    	
    	<!-- L'image du mec dont la source va changer lors des animations -->
    	<img id="imec0" alt="Mec" src="./animations/mec/1.png"/>
    	
    	<!-- Le téléphone portable -->
    	<img class="js_controlled" id="portable_mec" alt="portable_mec" src="./animations/mec/portable.png" />
    	
    	<!-- La poche qui cache le téléphone portable -->
    	<img  class="js_controlled" id="poche_basse_mec" alt="poche_basse_mec" src="./animations/mec/poche_portable.png" />
    	
    	<!-- Le iPod -->
    	<img class="js_controlled" id="ipod_mec" alt="ipod_mec" src="./animations/mec/ipod.png" />
    	
    	<!-- La poche qui le cache -->
    	<img  class="js_controlled" id="poche_pantalon" alt="poche_pantalon" src="./animations/mec/poche_iphone.png" />
    	
    	<!-- Le mouchoir -->
    	<img class="js_controlled" id="mouchoir_mec" alt="mouchoir_mec" src="./animations/mec/mouchoir.png" />
    	
    	<!-- La poche qui le cache -->
    	<img class="js_controlled" id="poche_mouchoir_mec" alt="poche_mouchoir_mec" src="./animations/mec/poche_mouchoir.png" />
    	
    </nav>
	
    
    <section id="content">
    	<div id="croix_contenu"></div>
    	
    	<div id="html_content">
    		<h1>MineNight in Paris</h1>
    		<p id="bienvenue"> Bienvenue sur le site du gala des Mines de Paris !
    		</p>	
    	</div>
    	
    </section>
    
    <!-- Affichage du lecteur (parallèlement avec le CSS) -->

		<section id="fond_splayer">
	
			<div id="ecran_splayer">
		
				<div id="splayer_playing_artist">Artiste</div>
				<div id="splayer_playing_title">Titre</div>
				<div id="splayer_playing_album">Album</div>
		
				<div id="splayer_bottom_bar">
					<div id="splayer_time_elapsed">0:00</div>
					<div id="splayer_time_remaining">-0:00</div>
					<div id="splayer_progressbar">
						<div id="splayer_backbar"></div>
					</div>
				</div>
	
			</div>
	
			<div id="prev_splayer" class="bplayer"></div>
			<div id="next_splayer" class="bplayer"></div>
			<div id="playpause_splayer" class="bplayer"></div>
		</div>

		<!-- Le cerveau du lecteur -->
		<audio class="song_playlist" id="song_daybreak">
			<source src="./contenus/player_songs/daybreak.mp3"></source>
		</audio>
		<audio class="song_playlist" id="song_fascination">
			<source src="./contenus/player_songs/fascination.mp3"></source>
		</audio>
		<audio class="song_playlist" id="song_sternenkinder">
			<source src="./contenus/player_songs/sternenkinder.mp3"></source>
		</audio>

		<script>
	
			document.querySelector("#next_splayer").addEventListener('click', pNext, false);
			document.querySelector("#prev_splayer").addEventListener('click', pPrev, false);
			document.querySelector("#playpause_splayer").addEventListener('click', pPlaypause, false);
	
			var tPlayers = document.querySelectorAll('.song_playlist');
	
			for(var i = 0; i < tPlayers.length; i++){
				tPlayers[i].addEventListener('timeupdate', function(){pUpdate();},false);
				tPlayers[i].addEventListener('progress', function(){pProgress();},false);
				tPlayers[i].addEventListener('ended', function(){pNext();},false);
			}
	
	
			tSongs = new Array(
				{id:'daybreak', titre:'Daybreak', artist:'Overwerk', album:'After Hours'},
				{id:'fascination', titre:'Fascination', artist:'Alphabeat', album:'Pub Coca'},
				{id:'sternenkinder', titre:'Sternenkinder', artist:'Klangkarussell', album:'Sonnentanz'}		
			);
	
			var currentSong = tSongs[0];
	
			function setCurrentSong(i){
				currentSong = tSongs[i];
				document.querySelector("#splayer_playing_artist").innerHTML = currentSong.artist;
				document.querySelector("#splayer_playing_title").innerHTML = currentSong.titre;
				document.querySelector("#splayer_playing_album").innerHTML = currentSong.album;
			}
	
			setCurrentSong(0);
	
			function pPlaypause(){
				var player = document.querySelector('#song_'+currentSong.id);
		
				if (player.paused) {
				    player.play();
				} else {
				    player.pause(); 
				}
			}
	
			function pResume(){
				var player = document.querySelector('#song_'+currentSong.id);
				player.currentTime=0;
				player.pause(); 
			}
	
			function pPrev(){
				currentNb = -1;
				for(var i=0; i < tSongs.length; i++){
					if(currentSong.id == tSongs[i].id)
						currentNb = i;
				}
		
		
				//Arrêt de la chanson courante
				pResume();
		
				//Changement de currentSong et play
				if(currentNb==0)
					currentNb=tSongs.length;
				currentNb--;
		
				setCurrentSong(currentNb);
				pPlaypause();
		
			}
	
			function pNext(){
				currentNb = -1;
				for(var i =0; i < tSongs.length; i++){
					if(currentSong.id == tSongs[i].id)
						currentNb = i;
				}
		
		
				//Arrêt de la chanson courante
				pResume();
		
				//Changement de currentSong et play
				if(currentNb==(tSongs.length-1))
					currentNb=-1;
				currentNb++;
		
				setCurrentSong(currentNb);
				pPlaypause();
			}
	
			//Mis à jour de la progress bar et des timers
			function pUpdate(){
				var player   = document.querySelector('#song_'+currentSong.id);
				var duration = player.duration;    // Durée totale
				var time     = player.currentTime; // Temps écoulé
				var fraction = time / duration;
				var percent  = Math.ceil(fraction * 100);
				
				minec = Math.floor(time/60);
				sec = Math.floor(time-minec*60);
				
				minre = Math.floor((duration-time)/60);
				sre = Math.floor(duration-time-minre*60);
				
				zerosec = sec/10 < 1 ? '0' : '';
				zerosre = sre/10 < 1 ? '0' : '';
				
				document.querySelector('#splayer_time_elapsed').innerHTML = minec + ':' + zerosec + sec;
		 		document.querySelector('#splayer_time_remaining').innerHTML = minre + ':' + zerosre + sre;
		 		
				var progress = document.querySelector('#splayer_backbar');
				 
				progress.style.width = percent + '%';
			}
	
			//Fonctions relatives au clic sur la barre de progression
				document.querySelector("#splayer_progressbar").addEventListener('click', {handleEvent : function(event){
	
				var player = document.querySelector('#song_'+currentSong.id);
			 
				var x = getMousePosition(event).x - getPosition(document.querySelector("#splayer_progressbar")).x; 
				
				var wrapperWidth = document.querySelector('#splayer_progressbar').offsetWidth;
				 
				var percent = Math.ceil((x / wrapperWidth) * 100);    
				var duration = player.duration;
				
				if (player.paused)
					player.play();
				
				player.currentTime = (duration * percent) / 100;
			}}, false);
	
			function getMousePosition(event) {
				if (event.pageX) {
				    return {
				        x: event.pageX,
				        y: event.pageY
				    };
				} else {
				    return { 
				        x: event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft, 
				        y: event.clientY + document.body.scrollTop  + document.documentElement.scrollTop
				    };
				}
			}   
	
			function getPosition(element){
				var top = 0, left = 0;
				 
				while (element) {
				    left   += element.offsetLeft;
				    top    += element.offsetTop;
				    element = element.offsetParent;
				}
				 
				return { x: left, y: top };
			}
			
			function pProgress(){
				var player = document.querySelector('#song_'+currentSong.id);
				var bufferedZones = player.buffered;
				
				//Ajout des buffered zones aux bons endroits de la barre de progression
					//On dégages toutes les zones grisées présentes
					$('.splayer_loadbar').remove();
					
					//On met les nouvelles
				for(var i = 0; i < bufferedZones.length; i++){
					$('<div class="splayer_loadbar"></div>').css({'left':bufferedZones.start(i)/player.duration*$('#splayer_progressbar').width(),'width':(bufferedZones.end(i) - bufferedZones.start(i))/player.duration*$('#splayer_progressbar').width()}).appendTo($('#splayer_progressbar'));
				}
				
			}

	
		</script>

		<!-- Fin de tout ce qui concerne le player -->

    <script src="./libraries/jquery.js"></script>
    <script src="./libraries/ajax.js"></script>
    <script src="./libraries/animations.js"></script>
 		
  </body>
  
</html>
